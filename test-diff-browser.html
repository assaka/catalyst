
<!DOCTYPE html>
<html>
<head>
    <title>Diff Flow Debug Test</title>
</head>
<body>
    <h1>Diff Flow Debug Test</h1>
    <div id="log"></div>
    
    <script>
    function log(message) {
        const logDiv = document.getElementById('log');
        logDiv.innerHTML += '<div>' + new Date().toLocaleTimeString() + ': ' + message + '</div>';
        console.log(message);
    }
    
    // Test 1: Event dispatching and listening
    log('üß™ Testing custom event system...');
    
    window.addEventListener('hybridPatchesLoaded', (event) => {
        log('‚úÖ hybridPatchesLoaded event received!');
        log('Event detail: ' + JSON.stringify(event.detail, null, 2));
        
        const { file, patches } = event.detail;
        log('File path: ' + file.path);
        log('Patches count: ' + patches.length);
        
        if (patches.length > 0) {
            log('First patch ID: ' + patches[0].id);
            log('Has diffHunks: ' + !!patches[0].diffHunks);
            log('DiffHunks count: ' + (patches[0].diffHunks?.length || 0));
        }
    });
    
    // Test 2: Simulate FileTreeNavigator dispatching event
    setTimeout(() => {
        log('üì° Simulating FileTreeNavigator dispatch...');
        
        const testData = {
    "file": {
        "path": "src/pages/Cart.jsx"
    },
    "patches": [
        {
            "id": "127c2722-a114-4a8b-9075-c4b3a8421085",
            "change_summary": "Initial customization created",
            "diffHunks": [
                {
                    "oldStart": 1,
                    "oldLines": 1,
                    "newStart": 1,
                    "newLines": 1,
                    "changes": [
                        {
                            "type": "del",
                            "content": "function Cart() { return <div>Original Cart</div>; }",
                            "oldLine": 1
                        },
                        {
                            "type": "add",
                            "content": "function Cart() { return <div>Modified Cart with new features</div>; }",
                            "newLine": 1
                        }
                    ]
                }
            ]
        }
    ]
};
        
        log('Dispatching event with ' + testData.patches.length + ' patches...');
        
        window.dispatchEvent(new CustomEvent('hybridPatchesLoaded', {
            detail: testData
        }));
        
        log('Event dispatched successfully');
    }, 1000);
    
    // Test 3: Check if DiffPreviewSystem would work
    setTimeout(() => {
        log('üéØ Testing DiffPreviewSystem logic...');
        
        const mockEvent = {
            detail: {
                file: { path: 'src/pages/Cart.jsx' },
                patches: [
    {
        "id": "127c2722-a114-4a8b-9075-c4b3a8421085",
        "customization_id": "6233a191-ae58-483a-837c-7fa460e80a95",
        "snapshot_number": 1,
        "change_type": "initial",
        "change_summary": "Initial customization created",
        "created_at": "2025-08-24T18:46:10.499Z",
        "ai_prompt": null,
        "diffHunks": [
            {
                "oldStart": 1,
                "oldLines": 1,
                "newStart": 1,
                "newLines": 1,
                "changes": [
                    {
                        "type": "del",
                        "content": "function Cart() { return <div>Original Cart</div>; }",
                        "oldLine": 1
                    },
                    {
                        "type": "add",
                        "content": "function Cart() { return <div>Modified Cart with new features</div>; }",
                        "newLine": 1
                    }
                ]
            }
        ],
        "metadata": {
            "customization_name": "Auto-saved changes to Cart.jsx",
            "version_number": 1,
            "component_type": "component",
            "affected_symbols": null
        }
    }
]
            }
        };
        
        const { file, patches } = mockEvent.detail;
        if (file.path === 'src/pages/Cart.jsx' && patches.length > 0) {
            log('‚úÖ DiffPreviewSystem condition check passed');
            const latestPatch = patches[0];
            
            if (latestPatch.diffHunks && latestPatch.diffHunks.length > 0) {
                log('‚úÖ Patch has diffHunks - would display in UI');
                log('DiffHunks: ' + latestPatch.diffHunks.length);
            } else {
                log('‚ùå Patch has no diffHunks - would show "No hybrid customizations detected"');
            }
        } else if (file.path === 'src/pages/Cart.jsx' && patches.length === 0) {
            log('‚ùå No patches - would show "No hybrid customizations detected"');
        }
    }, 2000);
    </script>
</body>
</html>