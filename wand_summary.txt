MAGIC TRANSLATION WAND - SUMMARY

FRONTEND COMPONENT
- File: src/components/admin/translations/ProductTranslationRow.jsx
- Icon: Wand2 from lucide-react
- Fields: Name, Short Description, Description
- Handler: handleAITranslate(field, fromLang, toLang)
- Location: Lines 209-224 (button), Lines 95-125 (handler)

API ENDPOINT
- Route: POST /api/translations/ai-translate
- File: backend/src/routes/translations.js (Lines 188-257)
- Auth: Required via authMiddleware
- Cost: 0.1 credits per translation

REQUEST BODY
{
  text: string (required)
  toLang: string (required)
  fromLang: string (default: 'en')
  storeId: string
  entityType: string (e.g., 'product')
}

RESPONSE
{
  success: true,
  data: {
    original: text,
    translated: translatedText,
    fromLang: 'en',
    toLang: 'nl'
  },
  creditsDeducted: 0.1
}

ERROR RESPONSE (HTTP 402)
{
  success: false,
  code: 'INSUFFICIENT_CREDITS',
  required: 0.1,
  available: balance
}

COST DETERMINATION
1. translationService.getTranslationCost('product')
2. Maps product → ai_translation_product (service key)
3. Queries service_credit_costs table
4. Returns 0.1 (or fallback if not found)

CREDIT DEDUCTION
1. Get current balance: SELECT credits FROM users WHERE id = userId
2. Check: balance >= 0.1
3. Atomic update: UPDATE users SET credits = credits - 0.1
4. Audit log: INSERT INTO credit_usage
5. Return: {credits_deducted: 0.1, remaining_balance: X}

TRANSACTION FLOW
User clicks Wand
  -> handleAITranslate validates source text
  -> POST /translations/ai-translate
  -> Backend: Get cost (0.1)
  -> Backend: Check balance (SELECT users.credits)
  -> If insufficient: Return 402 error
  -> Backend: AI translate text
  -> Backend: Deduct credits (UPDATE + INSERT)
  -> Frontend: Update form field
  -> Frontend: Show success toast

DATABASE TABLES
users:
  - credits (NUMERIC) - single source of truth

credit_usage:
  - user_id, store_id, credits_used (0.1)
  - reference_type: 'ai_translation'
  - description: 'AI Translation (product): en → nl'
  - metadata: {entityType, languages, lengths}

service_credit_costs:
  - service_key: 'ai_translation_product'
  - cost_per_unit: 0.1

COSTS
1 field to 1 language: 0.1 credits
All 3 fields to 1 language: 0.3 credits
All 3 fields to 5 languages: 1.5 credits

KEY FILES
- Frontend: src/components/admin/translations/ProductTranslationRow.jsx
- Endpoint: backend/src/routes/translations.js
- Costs: backend/src/services/translation-service.js
- Credits: backend/src/services/credit-service.js

BUTTON BEHAVIOR
- Only shown for non-English languages
- Disabled if English field is empty
- Shows spinning animation while translating
- Tooltip: "Cost: 0.1 credits per translation"

ERROR HANDLING
- Insufficient credits: No deduction, user sees error toast
- Translation failure: No deduction (check before translate)
- No source text: Client-side validation, no API call
